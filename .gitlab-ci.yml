deploy_production:
  stage: deploy
  only:
    - main  # DÃ©ploie seulement quand tu pousses sur la branche main
  tags:
    - deploy_production
  before_script:
    - eval $(ssh-agent -s)
    - chmod 600 "$CI_CD_SSH_KEY"
    - ssh-add "$CI_CD_SSH_KEY"
    - mkdir -p ~/.ssh
    - chmod 700 ~/.ssh
    - ssh-keyscan -H 113.30.191.17 >> ~/.ssh/known_hosts
  script:
    - |
      ssh -A -o StrictHostKeyChecking=no kamal@113.30.191.17 "bash ~/projet-demo-devops-v1/deploy.sh"